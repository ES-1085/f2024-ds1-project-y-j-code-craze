---
title: "Project memo"
author: "Y & J Code Craze"
output: html_document
---

This document should contain a detailed account of the data clean up for your data and the design choices you are making for your plots. For instance you will want to document choices you've made that were intentional for your graphic, e.g. color you've chosen for the plot. Think of this document as a code script someone can follow to reproduce the data cleaning steps and graphics in your handout.

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(tidyverse)
library(broom)
library(leaflet)
library(colorspace)
library(sf)
library(visdat)
library(naniar)
library(UpSetR)

Internship_Data_Untidy <- read.csv("/cloud/project/data/Internship_Data_Untidy.csv")
Tidy_Mapped_Clean <- read.csv("/cloud/project/data/Tidy_Mapped_Clean.csv")
Internship_Leaflet_Cleaned_Complete <- read_csv("/cloud/project/data/Internship_Leaflet_Cleaned - Complete.csv")
```

## Data Clean Up Steps for Overall Data

### Step 1: Tidy the Term Column

#### Step 1 a.) Change Entries with unknown term data to "NA" and unnesesary remove spaces before and after an entry 
```{r clear-unknown-term-data}
Internship_Data_Untidy %>% 
  mutate(Term = case_when( 
    Term %in% c("NA", "Not Stated", "-", "", "NA ", "All Year", "n/a", "Year", "Year-round", "N/A", "Previous Work Experience", "Nine Months", "Prior Fulfillment"))) ~ "NA" %>% 
  mutate(Term = str_squish(Term))
```

#### Step 1 b.) Ensure all terms fall under corespond to one COA term.

Because we are using the last recorded year from the "year" column, we are also using the last recorded term. The last term of each entry should correspond to the year the internship was completed 

```{r filtering-for-term}
Tidy_Term <- Internship_Data_Untidy %>% 
mutate(Term = case_when(
  Term %in% c("Fall", "Winter, Spring, Fall", "Winter, Fall", "Summer-Fall", "Spring, Fall", "Summer/Fall", "Summer, Fall", "Spring, Summer, Fall", "Summer,Fall", "Winter+Fall") ~ "Fall",
  Term %in% c("Winter", "Winter, Fall, Winter", "Fall/Winter", "December-December", "Summer, Fall, Winter", "Fall-Winter", "Fall, Winter", "Summer-Winter") ~ "Winter",
  Term %in% c("Spring", "Fall, Winter, Spring", "spring", "Winter, Spring", "Winter-Spring", "Novermber-Spring", "Summer, Spring, Spring") ~ "Spring",
  Term %in% c("Summer", "Fall, Summer", "August", "Winter-Summer", "Winter, Spring, Summer", "Winter, Summer", "Spring, Summer", "Fall+Summer", "Spring/Summer", "Fall, Winter, Spring, Summer", "Summe", "Summer 2011") ~ "Summer"
))
```

#### Step 1 c.) Yay it's tidy!
```{r ta-da}
Tidy_Term %>% 
  group_by(Term) %>%
  summarise(count = n())
```

### Step 2: Tidy the Year Column (All work applied to data frame "Tidy_Term")

### Step 2 a.) Check for all unique variables within the Year coloumn 

```{r year-variable-check}

unique(Tidy_Term$Year)
```

### Step 2 b.) Ensure all variables follow same format

The format is simply to state the year as a 4 digit integer. "XXXX". 
We were instructed by Jeffry to use the latest year for entries that span across multiple years.

```{r mutating-unique-years}
Tidy_Time <- Tidy_Term %>% 
mutate(Year = case_when(
  Year %in% c("1970") ~ "1970",
  Year %in% c("1973", "1973, 1974, 1975") ~ "1973",
  Year %in% c("1974") ~ "1974",
  Year %in% c("1975", "1974, 1975") ~ "1975",
  Year %in% c("1976") ~"1976",
  Year %in% c("1977", "1977, 1975, 1972") ~ "1977",
  Year %in% c("1978", "1977,1978") ~ "1978",
  Year %in% c("1979","1976-79") ~ "1979",
  Year %in% c("1980", "1978, 1979, 1980", "1979 and 1980") ~ "1980",
  Year %in% c("1981") ~ "1981",
  Year %in% c("1982", "1981, 1982") ~ "1982",
  Year %in% c("1983","1981-1983") ~ "1983",
  Year %in% c("1984") ~ "1984",
  Year %in% c("1985", "1984, 1985") ~ "1985",
  Year %in% c("1986", "1985, 1986") ~ "1986",
  Year %in% c("1987") ~"1987",
  Year %in% c("1988", "1987, 1988") ~ "1988",
  Year %in% c("1989") ~ "1989",
  Year %in% c("1990") ~ "1990",
  Year %in% c("1991") ~ "1991",
  Year %in% c("1992") ~ "1992",
  Year %in% c("1993", "1987-1993") ~ "1993",
  Year %in% c("1994") ~ "1994",
  Year %in% c("1995") ~ "1995",
  Year %in% c("1996", "1994, 1995, 1996", "1995, 1996") ~ "1996",
  Year %in% c("1997") ~ "1997",
  Year %in% c("1998", "	1997, 1998") ~ "1998",
  Year %in% c("1999", "1997, 1998, 1999", "1998/1999") ~ "1999",
  Year %in% c("2000") ~ "2000",
  Year %in% c("2001") ~ "2001",
  Year %in% c("2002", "2001, 2002") ~ "2002",
  Year %in% c("2003") ~ "2003",
  Year %in% c("2004") ~"2004",
  Year %in% c("2005", "2003, 2004, 2005") ~ "2005",
  Year %in% c("2006") ~ "2006",
  Year %in% c("2007", "2006, 2007") ~ "2007",
  Year %in% c("2008", "1996-2008") ~ "2008",
  Year %in% c("2009","2002 - 2009") ~ "2009",
  Year %in% c("2010", "2009-2010") ~ "2010",
  Year %in% c("2011","	2009-2011") ~ "2011",
  Year %in% c("2012") ~ "2012",
  Year %in% c("2013") ~ "2013",
  Year %in% c("2014", "	2013-2014") ~ "2014",
  Year %in% c("2015", "2014-15") ~ "2015",
  Year %in% c("2016", "	2015, 2016") ~ "2016",
  Year %in% c("2017", "	2015, 2016, 2017") ~ "2017",
  Year %in% c("2018") ~ "2018",
  Year %in% c("2019") ~ "2019",
  Year %in% c("2020") ~ "2020",
  Year %in% c("2021") ~ "2021",
  Year %in% c("2022") ~ "2022",
  Year %in% c("2023") ~ "2023"
))
```

### Step 2 c.) Double check unique terms

```{r year-variable-recheck}
Tidy_Time %>% 
  group_by(Year) %>%
  summarise(count = n())
```
yay! it's all tidy! 

### ggsave example for saving plots

```{r starwars ggsave example}
exp1 <- starwars |>
  filter(mass < 1000, 
         species %in% c("Human", "Cerean", "Pau'an", "Droid", "Gungan")) |>
  ggplot() +
  geom_point(aes(x = mass, 
                 y = height, 
                 color = species)) +
  labs(x = "Weight (kg)", 
       y = "Height (m)",
       color = "Species",
       title = "Weight and Height of Select Starwars Species",
       caption = paste("This data comes from the starwars api: https://swapi.py43.com"))


ggsave("example-starwars.png", width = 4, height = 4)

ggsave("example-starwars-wide.png", width = 6, height = 4)
```

### Step 3 Create a Decade Variable 
We wanted to layer our leaflet maps by decade. 
```{r create-decade}
Tidy_Mapped_Clean <- Tidy_Mapped_Clean %>% 
  mutate(Decade = (floor(Year/10)*10))

Internship_Leaflet_Cleaned_Complete <- Internship_Leaflet_Cleaned_Complete %>% 
  mutate(Decade = (floor(Year/10)*10))
```

### Test Plots: Year-Term Bar Polar Charts

```{r test-plot-1}
# Summarise the data by Year and Term
Tidy_Time_Summary <- Tidy_Time %>%
  drop_na(Term) %>% 
  drop_na(Year) %>% 
  group_by(Year, Term) %>%
  summarise(count = n()) %>%
  ungroup()

Tidy_Time_Summary %>% 
  ggplot(aes(x = Year, y = count, fill = fct_relevel(Term, c("Summer", "Spring", "Winter", "Fall")))) + 
  geom_bar(stat = "identity", position = "stack") + 
  coord_polar(start = 0) + 
  labs(
    title = "Student Internship Term Beakup by Year",
    subtitle = "Data from College of the Atlantic (1970 to 2023)",
    x = "Year",
    fill = "Term") +
  theme_minimal() +
  theme(axis.title.y = element_blank(),
        axis.line = element_blank(), 
        axis.ticks = element_blank(),
        axis.text.y = element_blank())
```

```{r test-plot-2}
Tidy_Time_Summary %>% 
  ggplot(aes(x = Term, y = count, fill = as.numeric(Year))) + 
  geom_bar(stat = "identity", position = "stack") + 
  coord_polar(start = 0) + 
  labs(
    title = "Student Internship Year Breakup by Term",
    subtitle = "Data from College of the Atlantic (1970 to 2023)",
    x = "Term",
    fill = "Year") + 
  theme_minimal() +  
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.key.size = unit(0.7, "lines")) +
  scale_fill_viridis_c(direction = -1)
```


```{r test-plot-3}
#building leaflet
#Things to change: decade, clustering (for later), sliding scale
pal <- colorFactor(palette = c("red", "orange", "yellow", "green", "blue", "purple"), domain = Tidy_Mapped_Clean$Decade)

leaflet(Tidy_Mapped_Clean) %>%
  addTiles() %>%
  setView(lng = mean(Tidy_Mapped_Clean$Longitude, na.rm = TRUE), 
          lat = mean(Tidy_Mapped_Clean$Latitude, na.rm = TRUE), 
          zoom = 2) %>%
  addCircleMarkers(data = Tidy_Mapped_Clean %>% filter(Decade == "1970"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "1970s",
                   popup = ~paste(Internship.Site, "<br>", Location),
                   clusterOptions = markerClusterOptions()) %>% 
  addCircleMarkers(data = Tidy_Mapped_Clean %>% filter(Decade == "1980"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "1980s",
                   popup = ~paste(Internship.Site, "<br>", Location),
                   clusterOptions = markerClusterOptions()) %>% 
  addCircleMarkers(data = Tidy_Mapped_Clean %>% filter(Decade == "1990"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "1990s",
                   popup = ~paste(Internship.Site, "<br>", Location),
                   clusterOptions = markerClusterOptions()) %>% 
  addCircleMarkers(data = Tidy_Mapped_Clean %>% filter(Decade == "2000"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "2000s",
                   popup = ~paste(Internship.Site, "<br>", Location),
                   clusterOptions = markerClusterOptions()) %>% 
  addCircleMarkers(data = Tidy_Mapped_Clean %>% filter(Decade == "2010"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "2010s",
                   popup = ~paste(Internship.Site, "<br>", Location),
                   clusterOptions = markerClusterOptions()) %>% 
  addCircleMarkers(data = Tidy_Mapped_Clean %>% filter(Decade == "2020"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "2020s",
                   popup = ~paste(Internship.Site, "<br>", Location),
                   clusterOptions = markerClusterOptions()) %>% 
  addLayersControl(overlayGroups = c("1970s", "1980s", "1990s", "2000s", "2010s", "2020s"),
                   options = layersControlOptions())
```

```{r test-plot-4}
leaflet(Tidy_Mapped_Clean) %>%
  addTiles() %>%
  setView(lng = mean(Tidy_Mapped_Clean$Longitude, na.rm = TRUE), 
          lat = mean(Tidy_Mapped_Clean$Latitude, na.rm = TRUE), 
          zoom = 2) %>%
  addMarkers(~Longitude, ~Latitude,
             clusterOptions = markerClusterOptions(),
             popup = ~paste(Internship.Site, "<br>", Location))
```

```{r test-plot-5}
pal <- colorFactor(palette = c("red", "orange", "yellow", "green", "blue", "purple"), domain = Internship_Leaflet_Cleaned_Complete$Decade)

leaflet(Internship_Leaflet_Cleaned_Complete) %>%
  addTiles() %>%
  setView(lng = mean(Internship_Leaflet_Cleaned_Complete$Longitude, na.rm = TRUE), 
          lat = mean(Internship_Leaflet_Cleaned_Complete$Latitude, na.rm = TRUE), 
          zoom = 2) %>%
  addCircleMarkers(data = Internship_Leaflet_Cleaned_Complete %>% filter(Decade == "1970"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "1970s",
                   popup = ~paste(Internship.Site, "<br>", Location)) %>% 
  addCircleMarkers(data = Internship_Leaflet_Cleaned_Complete %>% filter(Decade == "1980"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "1980s",
                   popup = ~paste(Internship.Site, "<br>", Location)) %>% 
  addCircleMarkers(data = Internship_Leaflet_Cleaned_Complete %>% filter(Decade == "1990"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "1990s",
                   popup = ~paste(Internship.Site, "<br>", Location)) %>% 
  addCircleMarkers(data = Internship_Leaflet_Cleaned_Complete %>% filter(Decade == "2000"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "2000s",
                   popup = ~paste(Internship.Site, "<br>", Location)) %>% 
  addCircleMarkers(data = Internship_Leaflet_Cleaned_Complete %>% filter(Decade == "2010"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "2010s",
                   popup = ~paste(Internship.Site, "<br>", Location)) %>% 
  addCircleMarkers(data = Internship_Leaflet_Cleaned_Complete %>% filter(Decade == "2020"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "2020s",
                   popup = ~paste(Internship.Site, "<br>", Location)) %>% 
  addLayersControl(overlayGroups = c("1970s", "1980s", "1990s", "2000s", "2010s", "2020s")) %>%
  addLegend("bottomright", 
            pal = pal, 
            values = Internship_Leaflet_Cleaned_Complete$Decade[!is.na(Internship_Leaflet_Cleaned_Complete$Decade)],
            title = "Decade",
            labFormat = labelFormat(prefix = ""))
```

### Plot 1: Bar Chart of Term ... more here

```{r plot-1}
Tidy_Time_Summary %>% 
  ggplot(aes(x = Term, y = count, fill = as.numeric(Year))) + 
  geom_bar(stat = "identity", position = "stack") + 
  coord_polar(start = 0) + 
  labs(
    title = "Student Internship Year Breakup by Term",
    subtitle = "Data from College of the Atlantic (1970 to 2023)",
    x = "Term",
    fill = "Year") + 
  theme_minimal() +  
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.key.size = unit(0.7, "lines")) +
  scale_fill_viridis_c(direction = -1)

ggsave("term-polar-chart.png", width = 4, height = 4)

ggsave("term-polar-chart-wide.png", width = 6, height = 4)
```

### Plot 2: Leaflet Map of Internships by Decade

### Plot 3: ~Coming Soon~

