---
title: "Project memo"
author: "Y & J Code Craze"
output: html_document
---

This document should contain a detailed account of the data clean up for your data and the design choices you are making for your plots. For instance you will want to document choices you've made that were intentional for your graphic, e.g. color you've chosen for the plot. Think of this document as a code script someone can follow to reproduce the data cleaning steps and graphics in your handout.

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(tidyverse)
library(broom)
library(leaflet)
library(colorspace)
library(sf)
library(visdat)
library(naniar)
library(UpSetR)
library(RColorBrewer)
library(ggthemes)
library(gapminder)

Internship_Data_Untidy <- read.csv("/cloud/project/data/Internship_Data_Untidy.csv")
Tidy_Mapped_Clean <- read.csv("/cloud/project/data/Tidy_Mapped_Clean.csv")
Internship_Leaflet_Official_Complete <- read_csv("/cloud/project/data/Internship_Leaflet_Official - Complete.csv")
```

## Data Clean Up Steps for Overall Data

### Step 1: Tidy the Term Column

#### Step 1 a.) Change Entries with unknown term data to "NA" and unnesesary remove spaces before and after an entry 

```{r clear-unknown-term-data}
Internship_Data_Untidy %>% 
  mutate(Term = case_when( 
    Term %in% c("NA", "Not Stated", "-", "", "NA ", "All Year", "n/a", "Year", "Year-round", "N/A", "Previous Work Experience", "Nine Months", "Prior Fulfillment"))) ~ "NA" %>% 
  mutate(Term = str_squish(Term))
```

#### Step 1 b.) Ensure all terms corespond to one COA term.

Because we are using the last recorded year from the "year" column, we are also using the last recorded term. The last term of each entry should correspond to the year the internship was completed. 

```{r filtering-for-term}
Tidy_Term <- Internship_Data_Untidy %>% 
mutate(Term = case_when(
  Term %in% c("Fall", "Winter, Spring, Fall", "Winter, Fall", "Summer-Fall", "Spring, Fall", "Summer/Fall", "Summer, Fall", "Spring, Summer, Fall", "Summer,Fall", "Winter+Fall") ~ "Fall",
  Term %in% c("Winter", "Winter, Fall, Winter", "Fall/Winter", "December-December", "Summer, Fall, Winter", "Fall-Winter", "Fall, Winter", "Summer-Winter") ~ "Winter",
  Term %in% c("Spring", "Fall, Winter, Spring", "spring", "Winter, Spring", "Winter-Spring", "Novermber-Spring", "Summer, Spring, Spring") ~ "Spring",
  Term %in% c("Summer", "Fall, Summer", "August", "Winter-Summer", "Winter, Spring, Summer", "Winter, Summer", "Spring, Summer", "Fall+Summer", "Spring/Summer", "Fall, Winter, Spring, Summer", "Summe", "Summer 2011") ~ "Summer"
))
```

#### Step 1 c.) Yay it's tidy!

```{r ta-da}
Tidy_Term %>% 
  group_by(Term) %>%
  summarise(count = n())
```

### Step 2: Tidy the Year Column (All work applied to data frame "Tidy_Term")

#### Step 2 a.) Check for all unique variables within the Year coloumn 

```{r year-variable-check}

unique(Tidy_Term$Year)
```

#### Step 2 b.) Ensure all variables follow same format

The format is simply to state the year as a 4 digit integer. "XXXX". 
We were instructed by Jeffry to use the latest year for entries that span across multiple years.

```{r mutating-unique-years}
Tidy_Time <- Tidy_Term %>% 
mutate(Year = case_when(
  Year %in% c("1970") ~ "1970",
  Year %in% c("1973", "1973, 1974, 1975") ~ "1973",
  Year %in% c("1974") ~ "1974",
  Year %in% c("1975", "1974, 1975") ~ "1975",
  Year %in% c("1976") ~"1976",
  Year %in% c("1977", "1977, 1975, 1972") ~ "1977",
  Year %in% c("1978", "1977,1978") ~ "1978",
  Year %in% c("1979","1976-79") ~ "1979",
  Year %in% c("1980", "1978, 1979, 1980", "1979 and 1980") ~ "1980",
  Year %in% c("1981") ~ "1981",
  Year %in% c("1982", "1981, 1982") ~ "1982",
  Year %in% c("1983","1981-1983") ~ "1983",
  Year %in% c("1984") ~ "1984",
  Year %in% c("1985", "1984, 1985") ~ "1985",
  Year %in% c("1986", "1985, 1986") ~ "1986",
  Year %in% c("1987") ~"1987",
  Year %in% c("1988", "1987, 1988") ~ "1988",
  Year %in% c("1989") ~ "1989",
  Year %in% c("1990") ~ "1990",
  Year %in% c("1991") ~ "1991",
  Year %in% c("1992") ~ "1992",
  Year %in% c("1993", "1987-1993") ~ "1993",
  Year %in% c("1994") ~ "1994",
  Year %in% c("1995") ~ "1995",
  Year %in% c("1996", "1994, 1995, 1996", "1995, 1996") ~ "1996",
  Year %in% c("1997") ~ "1997",
  Year %in% c("1998", "	1997, 1998") ~ "1998",
  Year %in% c("1999", "1997, 1998, 1999", "1998/1999") ~ "1999",
  Year %in% c("2000") ~ "2000",
  Year %in% c("2001") ~ "2001",
  Year %in% c("2002", "2001, 2002") ~ "2002",
  Year %in% c("2003") ~ "2003",
  Year %in% c("2004") ~"2004",
  Year %in% c("2005", "2003, 2004, 2005") ~ "2005",
  Year %in% c("2006") ~ "2006",
  Year %in% c("2007", "2006, 2007") ~ "2007",
  Year %in% c("2008", "1996-2008") ~ "2008",
  Year %in% c("2009","2002 - 2009") ~ "2009",
  Year %in% c("2010", "2009-2010") ~ "2010",
  Year %in% c("2011","	2009-2011") ~ "2011",
  Year %in% c("2012") ~ "2012",
  Year %in% c("2013") ~ "2013",
  Year %in% c("2014", "	2013-2014") ~ "2014",
  Year %in% c("2015", "2014-15") ~ "2015",
  Year %in% c("2016", "	2015, 2016") ~ "2016",
  Year %in% c("2017", "	2015, 2016, 2017") ~ "2017",
  Year %in% c("2018") ~ "2018",
  Year %in% c("2019") ~ "2019",
  Year %in% c("2020") ~ "2020",
  Year %in% c("2021") ~ "2021",
  Year %in% c("2022") ~ "2022",
  Year %in% c("2023") ~ "2023"
))
```

#### Step 2 c.) Double check unique terms

```{r year-variable-recheck}
Tidy_Time %>% 
  group_by(Year) %>%
  summarise(count = n())
```

Yay! it's all tidy! 

### Step 3: Create a Decade Variable 

We thought that it would be easier to visualize change over time if we used decades instead of years. We wanted to ensure that our plots were readable. 
Because this data set is growing, there aren't very many entries from the 2020s (specifically 2023). 

```{r create-decade-variable}
Internship_Leaflet_Official_Complete <- Internship_Leaflet_Official_Complete %>% 
  mutate(Decade = (floor(Year/10)*10))
```

### Step 4: Create Local, Domestic, and International Catagories 

We wanted to compare local, domestic, and international internships across multiple decades.
Most internships were formatted "City, US state" or "City, Country." We went into excel and changed entries to match this format. Canadian state names were changed to "City, Canada." Entries that were formatted "City, Non-US State, Country" were changed to "City, Country." We then separated the state or country at the comma. Anything with a US state after the comma was labeled "Domestic" and any country after the comma was labeled "International. 
All internships located in towns on MDI were counted as local. This was the easiest way to categorize local internships rather than having to decide which off-island towns/areas counted as local.

```{r create-location-type}
us_states <- c("Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", 
               "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho", 
               "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", 
               "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", 
               "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", 
               "New Hampshire", "New Jersey", "New Mexico", "New York", 
               "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", 
               "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", 
               "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", 
               "West Virginia", "Wisconsin", "Wyoming")
Internship_Leaflet_Official_Complete <- Internship_Leaflet_Official_Complete %>%
mutate(region = str_extract(Location, "(?<=, ).+$"),
       Location_Type = case_when(
         Location %in% c("Bar Harbor, Maine", "Northeast Harbor, Maine", "Southwest Harbor, Maine", "Otter Creek, Maine", "Seal Cove, Maine", "Mount Desert, Maine", "Mount Desert Island, Maine", "Hulls Cove, Maine", "Town Hill, Maine", "Somesville, Maine", "Salsbury Cove, Maine") ~ "Local",
      region %in% us_states ~ "Domestic",
      TRUE ~ "International"))
```

### Step 5 (not shown here): Manually Enter Missing lat/lon Variables 
Many of the locations in our data set were missing variables for latitude and longitude. Because r uses these variables to create leaflet maps, we couldn't visualize about half of the internships in our data set. Yeshaya first used Chat GPT to fill in the missing values. Chat GPT defaulted many of the missing locations to Bar Harbor. Yeshaya then went in and manually replaced all of the missing coordinates that Chat GPT couldn't find. There are still 1 or 2 internships that have coordinates that don't match the locations (they have Bar Harbor coordinates).  

### ggsave example for saving plots

```{r starwars ggsave example}
exp1 <- starwars |>
  filter(mass < 1000, 
         species %in% c("Human", "Cerean", "Pau'an", "Droid", "Gungan")) |>
  ggplot() +
  geom_point(aes(x = mass, 
                 y = height, 
                 color = species)) +
  labs(x = "Weight (kg)", 
       y = "Height (m)",
       color = "Species",
       title = "Weight and Height of Select Starwars Species",
       caption = paste("This data comes from the starwars api: https://swapi.py43.com"))


ggsave("example-starwars.png", width = 4, height = 4)

ggsave("example-starwars-wide.png", width = 6, height = 4)
```




### Plot 1: Amount of Internships per Term by Decade

We chose a faceted bar chart to visualize internship terms over time because we wanted to be able to easily compare each decade by term. We also wanted to show that summer is the most popular term for internships. This was the most readable visualization to communicate our goals.

We flipped our visualization horizontally so that it would be easier to compare the amount of internships between decades. 

There is only one column of graphs because we wanted to make it easier to compare the amount of internships between terms. We also wanted to make sure that the graphs have enough space to show the count per term. 

We decided to use a colorblind friendly color scheme in our plots so that they could be accessible for a wide audience. We used the scale_fill_viridis feature to do this.  

We wanted our legend to be readable, so we flipped it horizontally and separated the colors by decade.

```{r plot-1-final}
Internship_Leaflet_Official_Complete %>% 
  drop_na(Term) %>% 
  drop_na(Decade) %>% 
  group_by(Decade, Term) %>%
  summarise(count = n()) %>%
  ungroup() %>% 
  mutate(Term = fct_relevel(Term, "Fall", "Winter", "Spring", "Summer")) %>%  
ggplot(aes(x = Decade, y = count, fill = as.numeric(Decade))) + 
  geom_bar(stat = "identity", position = "stack") + 
  facet_wrap(~Term, nrow = 4, scales = "free_y") + 
  theme_minimal() +  
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.key.size = unit(0.7, "lines")) +
  scale_fill_viridis_c(direction = -1) +
  coord_flip() +
  theme(legend.position = "top") + 
  guides(fill = guide_legend(nrow = 1, byrow = TRUE)) +
  labs(
    y = "Number of Internships", 
    title = "Student Internship Year Breakup by Term",
    fill = "Decade")
```

### Plot 2: Top 10 Internships Done by COA Students

Because it was too difficult to sort each internship into alumni industries, we decided to see the most common organizations COA students interned for. 

```{r plot-2-final}
Top_10_Sites <- Internship_Leaflet_Official_Complete %>% 
  filter(!is.na(Internship.Site) & Internship.Site != "Prior Fulfillment of Internship Requirement") %>% 
  mutate(Internship.Site = case_when( 
    Internship.Site %in% c("MDI Biological Laboratory", "Mount Desert Island Biological Laboratory") ~ "MDI Biological Laboratory",
    TRUE ~ Internship.Site
  )) %>% 
  mutate(Internship.Site = case_when( 
    Internship.Site %in% c("The Jackson Laboratory", "Jackson Laboratory") ~ "Jackson Laboratory",
    TRUE ~ Internship.Site
  )) %>% 
  mutate(Internship.Site = str_squish(Internship.Site)) %>% 
mutate(Internship.Site = case_when( 
    Internship.Site %in% c("YMCA Camp Jordan", "YMCA Camp Erdman", "YMCA", "Mount Desert Island YMCA", "MDI YMCA", "Bar Harbor YMCA", "Bangor YMCA Camp Jordan") ~ "YMCA",
    TRUE ~ Internship.Site
  )) %>% 
  mutate(Internship.Site = str_squish(Internship.Site)) %>% 
mutate(Internship.Site = case_when( 
    Internship.Site %in% c("Summer Field Studies College of the Atlantic", "Summer Field Studies at COA", "Summer Field Studies") ~ "Summer Field Studies",
    TRUE ~ Internship.Site
  )) %>% 
  mutate(Internship.Site = str_squish(Internship.Site)) %>%
mutate(Internship.Site = case_when( 
    Internship.Site %in% c("Mount Desert Island Hospital", "MDI Hospital") ~ "Mount Desert Island Hospital",
    TRUE ~ Internship.Site
  )) %>% 
  mutate(Internship.Site = str_squish(Internship.Site)) %>%
mutate(Internship.Site = case_when( 
    Internship.Site %in% c("Island Reaserch Center", "Alice Eno Field Station on Great Duck Island", "Alice Eno Research Center", "Great Duck Island", "Alice Eno Biological Station and Mount Desert Rock") ~ "Great Duck Island Research Center",
    TRUE ~ Internship.Site
  )) %>% 
  mutate(Internship.Site = str_squish(Internship.Site)) %>%
mutate(Internship.Site = case_when( 
    Internship.Site %in% c("Acadia National Park Resource Management", "Acadia National Park") ~ "Acadia National Park",
    TRUE ~ Internship.Site
  )) %>% 
  mutate(Internship.Site = str_squish(Internship.Site)) %>%
  count(Internship.Site) %>% 
  arrange(desc(n)) %>% 
  slice_head(n = 10)

Top_10_Sites %>% 
  ggplot(aes(x = reorder(Internship.Site, n), y = n, fill = reorder(Internship.Site, n))) +
  geom_bar(stat = "identity") + 
  theme_minimal() +
  theme(legend.position = "none") +
  coord_flip() + 
  scale_fill_viridis_d(direction = -1) +
  labs(title = "Top 10 Internships Sites (Highest Frequency)",
       subtitle = "Data from 1970 to 2023",
       y = "Number of Internships") +
  theme(axis.title.y = element_blank())
```

### Plot 3: Local, Domestic, and International Internships Over Time

```{r test-plot-9}
Internship_Leaflet_Official_Complete %>%
  count(Year, Location_Type) %>%
  ggplot(aes(x = Year, y = n, colour = Location_Type)) +
  geom_line(size = 0.8) +
  theme_minimal() +
  labs(title = "Number of Internships per Year by Location Type",
       subtitle = "Local = On Mount Desert Island, Domestic = Within the USA, International = Outside the USA",
       x = "Year", 
       y = "Number of Internships",
       colour = "Type of Location") + 
  scale_colour_viridis_d() +
  geom_vline(xintercept = 2019, linetype = "dotted", colour = "red") +
  geom_vline(xintercept = 2022, linetype = "dotted",colour = "red") +
  annotate("rect",
           xmin = 2019,
           xmax = 2022,
           ymin = 0,
           ymax = 45,
           alpha = 0.2,
           fill = "red") +
  geom_text(aes(x = 2010, y = 40),
            label = "Drop due to COVID",
            colour = "black",
            family = "Times New Roman",
            size = 4.5)
```

### Plot 4.1: Leaflet Map of All Internships 

Explain

```{r tes-plot-6}
leaflet(Internship_Leaflet_Official_Complete) %>%
  addTiles() %>%
  setView(lng = mean(Internship_Leaflet_Official_Complete$Longitude, na.rm = TRUE), 
          lat = mean(Internship_Leaflet_Official_Complete$Latitude, na.rm = TRUE), 
          zoom = 2) %>%
  addMarkers(~Longitude, ~Latitude, 
             clusterOptions = markerClusterOptions(),
             popup = ~paste(Internship.Site, "<br>", Location, "<br>", Year))
```

### Plot 4.2: Leaflet Map of All Internships with Decade Layers

Explain, Explain

```{r final-leaflet-map-decades}
pal <- colorFactor(palette = c("red", "orange", "yellow", "green", "blue", "purple"), domain = Internship_Leaflet_Official_Complete$Decade)

leaflet(Internship_Leaflet_Official_Complete) %>%
  addTiles() %>%
  setView(lng = mean(Internship_Leaflet_Official_Complete$Longitude, na.rm = TRUE), 
          lat = mean(Internship_Leaflet_Official_Complete$Latitude, na.rm = TRUE), 
          zoom = 2) %>%
  addCircleMarkers(data = Internship_Leaflet_Official_Complete %>% filter(Decade == "1970"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "1970s",
                   popup = ~paste(Internship.Site, "<br>", Location, "<br>", Year)) %>% 
  addCircleMarkers(data = Internship_Leaflet_Official_Complete %>% filter(Decade == "1980"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "1980s",
                   popup = ~paste(Internship.Site, "<br>", Location, "<br>", Year)) %>% 
  addCircleMarkers(data = Internship_Leaflet_Official_Complete %>% filter(Decade == "1990"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "1990s",
                   popup = ~paste(Internship.Site, "<br>", Location, "<br>", Year)) %>% 
  addCircleMarkers(data = Internship_Leaflet_Official_Complete %>% filter(Decade == "2000"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "2000s",
                   popup = ~paste(Internship.Site, "<br>", Location, "<br>", Year)) %>% 
  addCircleMarkers(data = Internship_Leaflet_Official_Complete %>% filter(Decade == "2010"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "2010s",
                   popup = ~paste(Internship.Site, "<br>", Location, "<br>", Year)) %>% 
  addCircleMarkers(data = Internship_Leaflet_Official_Complete %>% filter(Decade == "2020"),
                   ~Longitude, 
                   ~Latitude, 
                   color = ~pal(Decade),
                   group = "2020s",
                   popup = ~paste(Internship.Site, "<br>", Location, "<br>", Year)) %>% 
  addLayersControl(overlayGroups = c("1970s", "1980s", "1990s", "2000s", "2010s", "2020s")) %>%
  addLegend("bottomright", 
            pal = pal, 
            values = Internship_Leaflet_Official_Complete$Decade[!is.na(Internship_Leaflet_Official_Complete$Decade)],
            title = "Decade",
            labFormat = labelFormat(prefix = ""))
```
